--// StarLight UI Library - Direct Test Version
local StarLight = {}
StarLight.__index = StarLight

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

-- Modern Color Palette
local COLORS = {
    bg = Color3.fromRGB(18, 18, 24),
    bgSecondary = Color3.fromRGB(25, 25, 32),
    accent = Color3.fromRGB(138, 99, 255),
    accentHover = Color3.fromRGB(158, 119, 255),
    success = Color3.fromRGB(88, 214, 141),
    danger = Color3.fromRGB(255, 107, 107),
    text = Color3.fromRGB(240, 240, 250),
    textDim = Color3.fromRGB(160, 160, 180),
    border = Color3.fromRGB(45, 45, 58)
}

function StarLight:CreateWindow(config)
    config = config or {}
    local windowTitle = config.Title or "StarLight UI"
    local windowSize = config.Size or UDim2.new(0, 280, 0, 288)
    
    local Window = {}
    Window.Elements = {}
    Window.Toggles = {}
    
    local player = Players.LocalPlayer
    local playerGui = player:WaitForChild("PlayerGui")
    
    -- Destroy existing UI
    if playerGui:FindFirstChild("StarLightUI") then
        playerGui:FindFirstChild("StarLightUI"):Destroy()
    end
    
    -- Create ScreenGui
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "StarLightUI"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    ScreenGui.Parent = playerGui
    
    -- Main Frame
    local Frame = Instance.new("Frame")
    Frame.Name = "MainFrame"
    Frame.Size = windowSize
    Frame.Position = UDim2.new(0.5, -windowSize.X.Offset/2, 0.5, -windowSize.Y.Offset/2)
    Frame.AnchorPoint = Vector2.new(0.5, 0.5)
    Frame.BackgroundColor3 = COLORS.bg
    Frame.BorderSizePixel = 0
    Frame.Parent = ScreenGui
    Frame.ClipsDescendants = true
    Frame.Active = true
    Frame.Draggable = true
    
    local FrameCorner = Instance.new("UICorner", Frame)
    FrameCorner.CornerRadius = UDim.new(0, 12)
    
    local FrameStroke = Instance.new("UIStroke", Frame)
    FrameStroke.Color = COLORS.border
    FrameStroke.Thickness = 1
    FrameStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    FrameStroke.Transparency = 0.3
    
    -- Header
    local Header = Instance.new("Frame")
    Header.Name = "Header"
    Header.Size = UDim2.new(1, 0, 0, 45)
    Header.BackgroundColor3 = COLORS.bgSecondary
    Header.BorderSizePixel = 0
    Header.Parent = Frame
    Header.ZIndex = 2
    
    local HeaderCorner = Instance.new("UICorner", Header)
    HeaderCorner.CornerRadius = UDim.new(0, 12)
    
    local HeaderFix = Instance.new("Frame")
    HeaderFix.Size = UDim2.new(1, 0, 0, 12)
    HeaderFix.Position = UDim2.new(0, 0, 1, -12)
    HeaderFix.BackgroundColor3 = COLORS.bgSecondary
    HeaderFix.BorderSizePixel = 0
    HeaderFix.Parent = Header
    
    -- Status Indicator
    local StatusDot = Instance.new("Frame")
    StatusDot.Name = "StatusDot"
    StatusDot.Size = UDim2.new(0, 8, 0, 8)
    StatusDot.Position = UDim2.new(0, 15, 0.5, -4)
    StatusDot.BackgroundColor3 = COLORS.success
    StatusDot.BorderSizePixel = 0
    StatusDot.Parent = Header
    
    local DotCorner = Instance.new("UICorner", StatusDot)
    DotCorner.CornerRadius = UDim.new(1, 0)
    
    local DotGlow = Instance.new("UIStroke", StatusDot)
    DotGlow.Color = COLORS.success
    DotGlow.Thickness = 2
    DotGlow.Transparency = 0.5
    
    -- Status animation
    task.spawn(function()
        while wait(1) do
            if StatusDot and StatusDot.Parent then
                TweenService:Create(DotGlow, TweenInfo.new(1, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut), {
                    Transparency = 0.2
                }):Play()
                wait(1)
                TweenService:Create(DotGlow, TweenInfo.new(1, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut), {
                    Transparency = 0.8
                }):Play()
            else
                break
            end
        end
    end)
    
    -- Title
    local Title = Instance.new("TextLabel")
    Title.Name = "Title"
    Title.Size = UDim2.new(0, 100, 1, 0)
    Title.Position = UDim2.new(0, 32, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = windowTitle
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 16
    Title.TextColor3 = COLORS.text
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.TextTruncate = Enum.TextTruncate.AtEnd
    Title.Parent = Header
    
    -- Window Controls
    local MinBtn = Instance.new("TextButton")
    MinBtn.Name = "MinBtn"
    MinBtn.Size = UDim2.new(0, 30, 0, 30)
    MinBtn.Position = UDim2.new(1, -70, 0.5, -15)
    MinBtn.BackgroundTransparency = 1
    MinBtn.Text = "-"
    MinBtn.TextColor3 = COLORS.textDim
    MinBtn.Font = Enum.Font.GothamBold
    MinBtn.TextSize = 20
    MinBtn.AutoButtonColor = false
    MinBtn.ZIndex = 5
    MinBtn.Parent = Header
    
    local CloseBtn = Instance.new("TextButton")
    CloseBtn.Name = "CloseBtn"
    CloseBtn.Size = UDim2.new(0, 30, 0, 30)
    CloseBtn.Position = UDim2.new(1, -35, 0.5, -15)
    CloseBtn.BackgroundTransparency = 1
    CloseBtn.Text = "×"
    CloseBtn.TextColor3 = COLORS.textDim
    CloseBtn.Font = Enum.Font.GothamBold
    CloseBtn.TextSize = 24
    CloseBtn.AutoButtonColor = false
    CloseBtn.ZIndex = 5
    CloseBtn.Parent = Header
    
    -- Content ScrollFrame
    local ScrollFrame = Instance.new("ScrollingFrame")
    ScrollFrame.Name = "ScrollFrame"
    ScrollFrame.Size = UDim2.new(1, 0, 1, -45)
    ScrollFrame.Position = UDim2.new(0, 0, 0, 45)
    ScrollFrame.BackgroundTransparency = 1
    ScrollFrame.BorderSizePixel = 0
    ScrollFrame.ScrollBarThickness = 4
    ScrollFrame.ScrollBarImageColor3 = COLORS.accent
    ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    ScrollFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    ScrollFrame.ScrollingDirection = Enum.ScrollingDirection.Y
    ScrollFrame.Parent = Frame
    
    local ScrollPadding = Instance.new("UIPadding", ScrollFrame)
    ScrollPadding.PaddingTop = UDim.new(0, 15)
    ScrollPadding.PaddingBottom = UDim.new(0, 15)
    ScrollPadding.PaddingLeft = UDim.new(0, 20)
    ScrollPadding.PaddingRight = UDim.new(0, 20)
    
    local ScrollLayout = Instance.new("UIListLayout", ScrollFrame)
    ScrollLayout.SortOrder = Enum.SortOrder.LayoutOrder
    ScrollLayout.Padding = UDim.new(0, 10)
    
    -- Minimized overlay
    local MinOverlay = Instance.new("TextButton")
    MinOverlay.Name = "MinOverlay"
    MinOverlay.Size = UDim2.new(1, 0, 1, 0)
    MinOverlay.BackgroundTransparency = 1
    MinOverlay.Text = ""
    MinOverlay.Visible = false
    MinOverlay.ZIndex = 1
    MinOverlay.Active = true
    MinOverlay.AutoButtonColor = false
    MinOverlay.Parent = Frame
    
    -- Setup hover effects
    local function setupHover(button)
        button.MouseEnter:Connect(function()
            TweenService:Create(button, TweenInfo.new(0.15), {
                BackgroundTransparency = 0.3,
                TextColor3 = COLORS.text
            }):Play()
        end)
        
        button.MouseLeave:Connect(function()
            TweenService:Create(button, TweenInfo.new(0.15), {
                BackgroundTransparency = 1,
                TextColor3 = COLORS.textDim
            }):Play()
        end)
    end
    
    setupHover(MinBtn)
    setupHover(CloseBtn)
    
    -- Minimize functionality
    local minimized = false
    local normalSize = Frame.Size
    local miniSize = UDim2.new(0, 180, 0, 45)
    
    local function setMinimized(state)
        if state == nil then minimized = not minimized else minimized = state end
        
        local tweenInfo = TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
        
        if minimized then
            MinBtn.Text = "+"
            ScrollFrame.Visible = false
            MinOverlay.Visible = true
            Frame.Draggable = false
            HeaderFix.Visible = false
            
            TweenService:Create(Frame, tweenInfo, {Size = miniSize}):Play()
        else
            MinBtn.Text = "-"
            ScrollFrame.Visible = true
            MinOverlay.Visible = false
            Frame.Draggable = true
            HeaderFix.Visible = true
            
            TweenService:Create(Frame, tweenInfo, {Size = normalSize}):Play()
        end
    end
    
    MinBtn.MouseButton1Click:Connect(function()
        setMinimized()
    end)
    
    MinOverlay.MouseButton1Click:Connect(function()
        setMinimized(false)
    end)
    
    -- Dragging for minimized state
    local dragStart, startPos, dragging = nil, nil, false
    
    MinOverlay.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = Frame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    MinOverlay.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            Frame.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)
    
    -- Close functionality
    CloseBtn.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
        if config.OnClose then
            config.OnClose()
        end
    end)
    
    local layoutOrder = 0
    
    -- Window Methods
    function Window:AddButton(text, callback)
        layoutOrder = layoutOrder + 1
        
        local Button = Instance.new("TextButton")
        Button.Name = text.."Button"
        Button.Size = UDim2.new(1, 0, 0, 48)
        Button.BackgroundColor3 = COLORS.bgSecondary
        Button.TextColor3 = COLORS.text
        Button.Text = text
        Button.Font = Enum.Font.GothamBold
        Button.TextSize = 14
        Button.AutoButtonColor = false
        Button.LayoutOrder = layoutOrder
        Button.Parent = ScrollFrame
        
        local ButtonCorner = Instance.new("UICorner", Button)
        ButtonCorner.CornerRadius = UDim.new(0, 10)
        
        local ButtonStroke = Instance.new("UIStroke", Button)
        ButtonStroke.Color = COLORS.border
        ButtonStroke.Thickness = 1
        ButtonStroke.Transparency = 0.5
        
        Button.MouseEnter:Connect(function()
            TweenService:Create(ButtonStroke, TweenInfo.new(0.2), {Transparency = 0.2}):Play()
        end)
        
        Button.MouseLeave:Connect(function()
            TweenService:Create(ButtonStroke, TweenInfo.new(0.2), {Transparency = 0.5}):Play()
        end)
        
        Button.MouseButton1Click:Connect(function()
            TweenService:Create(Button, TweenInfo.new(0.3), {BackgroundColor3 = COLORS.accent}):Play()
            wait(0.3)
            TweenService:Create(Button, TweenInfo.new(0.3), {BackgroundColor3 = COLORS.bgSecondary}):Play()
            
            if callback then
                callback()
            end
        end)
        
        return Button
    end
    
    function Window:AddToggle(text, default, callback)
        layoutOrder = layoutOrder + 1
        local toggled = default or false
        
        local Toggle = Instance.new("TextButton")
        Toggle.Name = text.."Toggle"
        Toggle.Size = UDim2.new(1, 0, 0, 48)
        Toggle.BackgroundColor3 = toggled and COLORS.accent or COLORS.bgSecondary
        Toggle.TextColor3 = COLORS.text
        Toggle.Text = text
        Toggle.Font = Enum.Font.GothamBold
        Toggle.TextSize = 14
        Toggle.AutoButtonColor = false
        Toggle.LayoutOrder = layoutOrder
        Toggle.Parent = ScrollFrame
        
        local ToggleCorner = Instance.new("UICorner", Toggle)
        ToggleCorner.CornerRadius = UDim.new(0, 10)
        
        local ToggleStroke = Instance.new("UIStroke", Toggle)
        ToggleStroke.Color = COLORS.border
        ToggleStroke.Thickness = 1
        ToggleStroke.Transparency = 0.5
        
        Toggle.MouseEnter:Connect(function()
            TweenService:Create(ToggleStroke, TweenInfo.new(0.2), {Transparency = 0.2}):Play()
        end)
        
        Toggle.MouseLeave:Connect(function()
            TweenService:Create(ToggleStroke, TweenInfo.new(0.2), {Transparency = 0.5}):Play()
        end)
        
        local toggleData = {
            Enabled = toggled,
            Callback = callback,
            Button = Toggle
        }
        
        Window.Toggles[text] = toggleData
        
        Toggle.MouseButton1Click:Connect(function()
            toggled = not toggled
            toggleData.Enabled = toggled
            
            if toggled then
                TweenService:Create(Toggle, TweenInfo.new(0.3), {BackgroundColor3 = COLORS.accent}):Play()
            else
                TweenService:Create(Toggle, TweenInfo.new(0.3), {BackgroundColor3 = COLORS.bgSecondary}):Play()
            end
            
            if callback then
                callback(toggled)
            end
        end)
        
        return toggleData
    end
    
    function Window:AddTextBox(text, placeholder, callback)
        layoutOrder = layoutOrder + 1
        
        local Container = Instance.new("Frame")
        Container.Name = text.."Container"
        Container.Size = UDim2.new(1, 0, 0, 48)
        Container.BackgroundColor3 = COLORS.bgSecondary
        Container.BorderSizePixel = 0
        Container.LayoutOrder = layoutOrder
        Container.Parent = ScrollFrame
        
        local ContainerCorner = Instance.new("UICorner", Container)
        ContainerCorner.CornerRadius = UDim.new(0, 10)
        
        local ContainerStroke = Instance.new("UIStroke", Container)
        ContainerStroke.Color = COLORS.border
        ContainerStroke.Thickness = 1
        ContainerStroke.Transparency = 0.5
        
        local Label = Instance.new("TextLabel")
        Label.Size = UDim2.new(0, 80, 1, 0)
        Label.Position = UDim2.new(0, 15, 0, 0)
        Label.BackgroundTransparency = 1
        Label.Text = text
        Label.Font = Enum.Font.GothamMedium
        Label.TextSize = 13
        Label.TextColor3 = COLORS.textDim
        Label.TextXAlignment = Enum.TextXAlignment.Left
        Label.Parent = Container
        
        local TextBox = Instance.new("TextBox")
        TextBox.Name = "Input"
        TextBox.Size = UDim2.new(1, -110, 1, 0)
        TextBox.Position = UDim2.new(0, 95, 0, 0)
        TextBox.BackgroundTransparency = 1
        TextBox.TextColor3 = COLORS.text
        TextBox.Font = Enum.Font.GothamBold
        TextBox.TextSize = 15
        TextBox.PlaceholderText = placeholder or ""
        TextBox.PlaceholderColor3 = COLORS.textDim
        TextBox.ClearTextOnFocus = false
        TextBox.Text = ""
        TextBox.TextXAlignment = Enum.TextXAlignment.Right
        TextBox.Parent = Container
        
        TextBox.Focused:Connect(function()
            TweenService:Create(ContainerStroke, TweenInfo.new(0.2), {
                Color = COLORS.accent,
                Transparency = 0
            }):Play()
        end)
        
        TextBox.FocusLost:Connect(function()
            TweenService:Create(ContainerStroke, TweenInfo.new(0.2), {
                Color = COLORS.border,
                Transparency = 0.5
            }):Play()
            
            if callback then
                callback(TextBox.Text)
            end
        end)
        
        return TextBox
    end
    
    function Window:AddSlider(text, min, max, default, callback)
        layoutOrder = layoutOrder + 1
        local currentValue = default or min
        
        local Container = Instance.new("Frame")
        Container.Name = text.."Slider"
        Container.Size = UDim2.new(1, 0, 0, 60)
        Container.BackgroundColor3 = COLORS.bgSecondary
        Container.BorderSizePixel = 0
        Container.LayoutOrder = layoutOrder
        Container.Parent = ScrollFrame
        
        local ContainerCorner = Instance.new("UICorner", Container)
        ContainerCorner.CornerRadius = UDim.new(0, 10)
        
        local ContainerStroke = Instance.new("UIStroke", Container)
        ContainerStroke.Color = COLORS.border
        ContainerStroke.Thickness = 1
        ContainerStroke.Transparency = 0.5
        
        local Label = Instance.new("TextLabel")
        Label.Size = UDim2.new(1, -30, 0, 20)
        Label.Position = UDim2.new(0, 15, 0, 8)
        Label.BackgroundTransparency = 1
        Label.Text = text
        Label.Font = Enum.Font.GothamMedium
        Label.TextSize = 13
        Label.TextColor3 = COLORS.textDim
        Label.TextXAlignment = Enum.TextXAlignment.Left
        Label.Parent = Container
        
        local ValueLabel = Instance.new("TextLabel")
        ValueLabel.Name = "Value"
        ValueLabel.Size = UDim2.new(0, 40, 0, 20)
        ValueLabel.Position = UDim2.new(1, -55, 0, 8)
        ValueLabel.BackgroundTransparency = 1
        ValueLabel.Text = tostring(currentValue)
        ValueLabel.Font = Enum.Font.GothamBold
        ValueLabel.TextSize = 13
        ValueLabel.TextColor3 = COLORS.text
        ValueLabel.TextXAlignment = Enum.TextXAlignment.Right
        ValueLabel.Parent = Container
        
        local Track = Instance.new("TextButton")
        Track.Name = "Track"
        Track.Size = UDim2.new(1, -30, 0, 6)
        Track.Position = UDim2.new(0, 15, 1, -18)
        Track.BackgroundColor3 = COLORS.bg
        Track.BorderSizePixel = 0
        Track.Text = ""
        Track.AutoButtonColor = false
        Track.Parent = Container
        
        local TrackCorner = Instance.new("UICorner", Track)
        TrackCorner.CornerRadius = UDim.new(1, 0)
        
        local Fill = Instance.new("Frame")
        Fill.Name = "Fill"
        Fill.Size = UDim2.new((currentValue - min) / (max - min), 0, 1, 0)
        Fill.BackgroundColor3 = COLORS.accent
        Fill.BorderSizePixel = 0
        Fill.Parent = Track
        
        local FillCorner = Instance.new("UICorner", Fill)
        FillCorner.CornerRadius = UDim.new(1, 0)
        
        local Handle = Instance.new("Frame")
        Handle.Name = "Handle"
        Handle.Size = UDim2.new(0, 16, 0, 16)
        Handle.Position = UDim2.new(1, -8, 0.5, -8)
        Handle.BackgroundColor3 = COLORS.text
        Handle.BorderSizePixel = 0
        Handle.Parent = Fill
        
        local HandleCorner = Instance.new("UICorner", Handle)
        HandleCorner.CornerRadius = UDim.new(1, 0)
        
        local dragging = false
        
        local function updateSlider(mouseX)
            local trackPos = Track.AbsolutePosition.X
            local trackSize = Track.AbsoluteSize.X
            
            local relativePos = math.clamp(mouseX - trackPos, 0, trackSize)
            local percentage = relativePos / trackSize
            
            currentValue = math.floor(min + (max - min) * percentage)
            
            TweenService:Create(Fill, TweenInfo.new(0.1), {
                Size = UDim2.new(percentage, 0, 1, 0)
            }):Play()
            
            ValueLabel.Text = tostring(currentValue)
            
            if callback then
                callback(currentValue)
            end
        end
        
        Track.MouseButton1Down:Connect(function(x, y)
            dragging = true
            updateSlider(x)
        end)
        
        UserInputService.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                dragging = false
            end
        end)
        
        Track.MouseMoved:Connect(function(x, y)
            if dragging then
                updateSlider(x)
            end
        end)
        
        return {
            SetValue = function(value)
                currentValue = math.clamp(value, min, max)
                local percentage = (currentValue - min) / (max - min)
                
                TweenService:Create(Fill, TweenInfo.new(0.1), {
                    Size = UDim2.new(percentage, 0, 1, 0)
                }):Play()
                
                ValueLabel.Text = tostring(currentValue)
                
                if callback then
                    callback(currentValue)
                end
            end,
            GetValue = function()
                return currentValue
            end
        }
    end
    
    function Window:Destroy()
        ScreenGui:Destroy()
    end
    
    return Window
end

-- DOĞRUDAN TEST KODU (Library'yi test etmek için)
local TestWindow = StarLight:CreateWindow({
    Title = "StarLight Test",
    Size = UDim2.new(0, 280, 0, 350)
})

-- Test butonları ekle
TestWindow:AddButton("Test Button", function()
    print("StarLight UI çalışıyor!")
end)

TestWindow:AddToggle("Test Toggle", false, function(state)
    print("Toggle durumu:", state)
end)

TestWindow:AddTextBox("Test Input", "Bir şey yaz", function(value)
    print("Girilen değer:", value)
end)

TestWindow:AddSlider("Test Slider", 0, 100, 50, function(value)
    print("Slider değeri:", value)
end)

print("StarLight UI başarıyla yüklendi!")
